(function(){function z(a,b,c){function e(a,b){if(!a)return null;var c="",f=null;if(a.childNodes&&0<a.childNodes.length)for(var d=0;d<a.childNodes.length;d++){var j=a.childNodes[d],l=j.nodeType,g=j.localName||j.nodeName||"",m=j.text||j.nodeValue||"";if(8!=l)if(3==l||4==l||!g)c+=m.replace(/^\s+|\s+$/g,"");else if(f=f||{},f[g]){if(!(f[g]instanceof Array)||!f[g].length)f[g]=[f[g]];f[g].push(e(j,!0))}else f[g]=e(j,!1)}if(a.attributes&&!k&&0<a.attributes.length){f=f||{};for(j=0;j<a.attributes.length;j++)g=
a.attributes[j],l=g.name||"",g=g.value,f[l]?(!(f[l]instanceof Array)&&f[l].length&&(f[l]=[f[l]]),f[l].push(g)):f[l]=g}if(f){if(""!=c){j=new String(c);for(d in f)j[d]=f[d];f=j}if(c=f.text?("object"==typeof f.text?f.text:[f.text||""]).concat([c]):c)f.text=c;c=""}f=f||c;if(h){c&&(f={});if(c=f.text||c||"")f.text=c;!b&&!(f instanceof Array)&&(f=[f])}return f}var h=b,k=c;if(!a)return{};"string"==typeof a&&(a=B(a));if(a.nodeType){if(3==a.nodeType||4==a.nodeType)return a.nodeValue;a=9==a.nodeType?a.documentElement:
a;b=e(a,!0);a=a=null;return b}}function B(a){var b;try{var c=new DOMParser;c.async=!1;b=c.parseFromString(a,"text/xml")}catch(e){throw Error("Error parsing XML string");}return b}function t(a){for(var b=[],c=0;c<8*a.length;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<24-c%32;a=8*a.length;b[a>>5]|=128<<24-a%32;b[(a+64>>9<<4)+15]=a;for(var a=Array(80),c=1732584193,e=-271733879,h=-1732584194,d=271733878,i=-1009589776,n=0;n<b.length;n+=16){for(var A=c,f=e,o=h,j=d,l=i,g=0;80>g;g++){a[g]=16>g?b[n+g]:(a[g-3]^
a[g-8]^a[g-14]^a[g-16])<<1|(a[g-3]^a[g-8]^a[g-14]^a[g-16])>>>31;var p=m(m(c<<5|c>>>27,20>g?e&h|~e&d:40>g?e^h^d:60>g?e&h|e&d|h&d:e^h^d),m(m(i,a[g]),20>g?1518500249:40>g?1859775393:60>g?-1894007588:-899497514)),i=d,d=h,h=e<<30|e>>>2,e=c,c=p}c=m(c,A);e=m(e,f);h=m(h,o);d=m(d,j);i=m(i,l)}b=[c,e,h,d,i];a="";for(c=0;c<4*b.length;c++)a+="0123456789abcdef".charAt(b[c>>2]>>8*(3-c%4)+4&15)+"0123456789abcdef".charAt(b[c>>2]>>8*(3-c%4)&15);return a}function m(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+
(c>>16)<<16|c&65535}var q,o,s,d,u,v,p,w,x,y,r=function(a,b){return function(){return a.apply(b,arguments)}};window.offline_mode=!navigator.onLine;window.app={back:function(){return history.go(-1)},autologin:"on"===$("#autologin").val(),offline:function(){return!navigator.onLine}};setTimeout(function(){if(window.offline_mode&&navigator.onLine)return confirm("You are online now, \npress OK to reload the App and enable online features!")?location.reload():setTimeout(arguments.callee,6E4)},1E4);app.offline()&&
$(document.body).addClass("offline");p=function(a,b){if(null!=a.svc&&null==b)b=a,a=b.svc;else if("string"===typeof a)b.svc=a;b.type=null!=b.type&&/get/i.test(b.type)?"GET":"POST";if("POST"===b.type)b.data=JSON.stringify(b.data);b.nowait||$.mobile.showPageLoadingMsg();$.ajax({url:"svc/"+b.svc+".svc/"+b.method,type:b.type,dataType:"json",contentType:"application/json;charset=utf-8",data:b.data,processdata:"POST"!==b.type,complete:function(){if(!b.nowait)return $.mobile.hidePageLoadingMsg(),"function"===
typeof b.complete?b.complete():void 0},success:function(a,e,h){if(!b.nowait){if(null!=a&&"d"in a)return"function"===typeof b.callback?b.callback(a.d):void 0;alert("Network Error");return console.log("err",h,h.statusText)}},error:function(a){alert("Network Error");return console.log("err",a,a.statusText)}});return!1};o={dateToWcf:function(a){var b;b=(new Date).getTimezoneOffset()/60;return"/Date("+ +(Date.parse(a)-36E5*b)+(0<b?"-":"+")+(9<b?"":"0")+b+"00)/"},dateFromWcf:function(a){a=a.match(/^\/Date\((\d+)([+-]\d{2})(\d{2})\)\/$/);
return 4!==a.length?null:new Date(Number(a[1])-36E5*Number(a[2]))},dateToStr:function(a){a=new Date(a);return""+a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()},dateToUTC:function(a){a=new Date(a);return""+a.getUTCFullYear()+"-"+(a.getUTCMonth()+1)+"-"+a.getUTCDate()+"T"+a.getUTCHours()+":"+a.getUTCMinutes()+":"+a.getUTCSeconds()}};try{app.user=JSON.parse(sessionStorage.user||localStorage.user),0<(null!=(w=app.user)?w.uid:void 0)&&32===(null!=
(x=app.user)?null!=(y=x.sid)?y.length:void 0:void 0)?(location.hash="#home",p("user",{method:"check",data:{uid:app.user.uid,sid:app.user.sid},callback:function(a){console.log("check",a);a||$.mobile.changePage("#login",{transition:"none"});return null}})):location.hash="#login"}catch(C){app.user=null,location.hash="#login"}console.log("app.user",app.user);app.save_profile=window.onbeforeunload=function(){var a;if(null!=(a=app.user)&&a.uid){if(a=sessionStorage.user=JSON.stringify(app.user),app.autologin)localStorage.user=
a}else localStorage.removeItem("user"),sessionStorage.removeItem("user")};$('[data-role="page"] [data-role="header"]:not(.ui-non-nav)').append($('[data-btn-role="back"],[data-btn-role="home"]'));$('#search [data-btn-role="home"]').hide();q=document.body;u=$(document.querySelectorAll('[data-role="map"]'));$(window).resize(function(){console.log("resize",q.clientWidth,q.clientHeight);app.horizontal=q.clientWidth>q.clientHeight;return $(q)[app.horizontal?"addClass":"removeClass"]("horizontal")});$(document.body).resize();
d=app.map=null;if(!app.offline())$("#home").one({pageshow:function(){return d.el.offset($("#home_map").offset())}}),d=app.map=new google.maps.Map($("#map")[0],{zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,navigationControl:!0,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}}),d.plcsvc=new google.maps.places.PlacesService(d),d.geocoder=new google.maps.Geocoder,d.dirsvc=new google.maps.DirectionsService,d.dirrdr=new google.maps.DirectionsRenderer,d.svbounds=new google.maps.LatLngBounds(new google.maps.LatLng(38.052417,
-122.728271),new google.maps.LatLng(37.247821,-121.552734)),function(){this.el=$("#map");(new google.maps.TrafficLayer).setMap(this);return $.extend(this,{setMarkers:r(function(a){console.log("markers",a);a?$.isArray(a)||(a=[a]):a=null;null!=this.markers&&this.markers.forEach(function(a){return a.setMap(null)});this.markers=null!=a?a.map(function(a){a.map=d;return new google.maps.Marker(a)}):null;return this},this),getCurPos:r(function(a,b){null==b&&(b=a,a=!0);app.offline()?b.call(this,null,null):
null!=navigator.geolocation&&navigator.geolocation.getCurrentPosition(r(function(c){var e;e=new google.maps.LatLng(c.coords.latitude,c.coords.longitude);console.log("curlatlng",e);if(!e.equals(this.getCenter()))e.changed=!0;return a&&e.changed?(this.setMarkers(null),this.setCenter(e),u.each(r(function(a,b){return $(b).css("background-image","url('//maps.googleapis.com/maps/api/staticmap?center="+e.lat()+","+e.lng()+"&zoom="+($(b).attr("data-map-zoom")||15)+"&size="+$(window).width()+"x"+this.el.height()+
"&maptype=roadmap&format=png8&sensor=true&language=en')")},this)),d.geocoder.geocode({latLng:e},r(function(a,c){var d;c===google.maps.GeocoderStatus.OK?b.call(this,e,null!=(d=a[0])?d.formatted_address:void 0):alert("Geocoder failed due to: "+c+"\n App terminated!");return this.setCenter(e)},this))):b.call(this,e)},this),function(){return alert("App cannot run without geo location!")});return this},this)})}.call(d),$('[data-role="page"]').bind({pagebeforeshow:function(){d.el.addClass("hidden");return $(document.body)[app.offline()?
"addClass":"removeClass"]("offline")},pageshow:function(){var a,b;$.mobile.fixedToolbars.show();this.hh=(null!=(a=$('[data-role="header"]',this))?a.outerHeight():void 0)||0;this.fh=(null!=(b=$('[data-role="footer"]',this))?b.outerHeight():void 0)||0;this.bh=document.body.clientHeight-this.hh-this.fh;$(".map",this).add(d.el).height(this.bh*(app.horizontal?1:0.45));if($(this).hasClass("has-map"))return d.el.removeClass("hidden")}});app.sync_weather=function(){var a;a=function(a){var c,e;null!=(null!=
(c=a.weather)?c.current_conditions:void 0)?(c=a.weather.current_conditions,console.log("w:",a),e=function(a){return"//www.google.com"+a.icon.data},c=$("#weather").html('<div id="weather_now" class="weather"><img src="'+e(c)+'"/>'+c.condition.data+"<br/>"+c.temp_f.data+"\u00b0F</div>"),c.append(a.weather.forecast_conditions.map(function(a){return'<div class="weather"><img src="'+e(a)+'"/>'+a.day_of_week.data+" "+a.high.data+"/"+a.low.data+"\u00b0F</div>"}).join(""))):$("#weather").html("(No Weather Data)");
return this};return app.offline()?null!=localStorage.weather?a(JSON.parse(localStorage.weather)):a(null):$.ajax({url:"gapi?&hl=en-us&weather=san+jose,ca",dataType:"xml",success:function(b){b=z(b);localStorage.weather=JSON.stringify(b);return a(b)},error:function(a){return console.log("get weather failed",a)}})};s=function(a,b){return t("KnightRiderX\u00b5\u0004\u0005\u00f1PGo\u00f0@\u00d8\u00f4\u00ed\u009d\u00d2y\u00c0n\u00a6\u00d9\u00ffKnightRider"+a+t("KnightRiderX\u00b5\u0004\u0005\u00f1PGo\u00f0@\u00d8\u00f4\u00ed\u009d\u00d2y\u00c0n\u00a6\u00d9\u00ffKnightRider"+
a+"\u00ff"+b+"KnightRiderX\u00b5\u0004\u0005\u00f1PGo\u00f0@\u00d8\u00f4\u00ed\u009d\u00d2y\u00c0n\u00a6\u00d9\u00ffKnightRider")+b+"KnightRiderX\u00b5\u0004\u0005\u00f1PGo\u00f0@\u00d8\u00f4\u00ed\u009d\u00d2y\u00c0n\u00a6\u00d9\u00ffKnightRider")};if(null!=window.openDatabase)app.db=openDatabase("KnightRider","1.0","Data cache for Knight Rider",2E5),null!=app.db?(app.db._onerr=function(a,b){return console.error("local db error",a,b)},app.db.sync=function(a,b){var c;p(a,{method:"sync",type:"get",
data:{last:o.dateToStr(new Date((null!=(c=app.user)?c.last_sync_alert:void 0)||0))},callback:function(c){console.log("sync",a,c);if(null!=app.user)app.user.last_sync_alert=(new Date).getTime()-1E4;return"function"===typeof b?b(c):void 0}});return this},app.db.alerts_sync=function(a){var b;b=function(c){return c.executeSql("SELECT * FROM [Alerts] WHERE expired > strftime('%s','now') ORDER BY datetime DESC, importance DESC;",[],function(c,b){var d,i,n;console.log("alerts count",b.rows.length);n=[];
for(d=b.rows.length;d;)i=$.extend({},b.rows.item(--d)),i.datetime=new Date(i.datetime),i.expired=new Date(i.expired),i.created=new Date(i.created),i.modified=new Date(i.modified),n.unshift(i);console.log("alerts from db",n,b);return"function"===typeof a?a(n):void 0},app.db._onerr)};app.offline()?app.db.transaction(b):app.db.sync("alerts",function(a){app.db.transaction(function(e){var d,k;a.length&&(d=a.map(function(a){return a.id}),k=a.map(function(a){return[a.id,a.summary,a.message,o.dateFromWcf(a.datetime).getTime(),
o.dateFromWcf(a.expired).getTime(),a.importance,a.type,a.status,o.dateFromWcf(a.created).getTime(),o.dateFromWcf(a.modified).getTime()]}),console.log("db","INSERT INTO [Alerts](id,summary,message,datetime,expired,importance,type,status,created,modified) VALUES (?,?,?,?,?,?,?,?,?,?);",k),e.executeSql("DELETE FROM [Alerts] WHERE id IN ("+d.join(",")+")"),k.forEach(function(a){return e.executeSql("INSERT INTO [Alerts](id,summary,message,datetime,expired,importance,type,status,created,modified) VALUES (?,?,?,?,?,?,?,?,?,?);",
a)}));b(e);return this});return this});return this},app.db.transaction(function(a){return a.executeSql("CREATE TABLE IF NOT EXISTS [Alerts] (\t\t\t\tid INT UNIQUE, \t\t\t\tsummary NVARCHAR(100), \t\t\t\tmessage TEXT, \t\t\t\tdatetime LONG, \t\t\t\texpired LONG, \t\t\t\timportance TINYINT, \t\t\t\ttype TINYINT, \t\t\t\tstatus TINYINT,\t\t\t\tcreated LONG, \t\t\t\tmodified LONG\t\t\t)")})):alert("open db err");$("#home").bind({pagecreate:function(){return this.created=!0},pagebeforeshow:function(){console.log("home pageshow");
app.offline()?$("#home_addr").text("You are offline now"):window.offline_mode||d.getCurPos(function(a,b){null!=b&&$("#home_addr").text(b);this.setZoom(15);return this.setMarkers({position:a})});app.sync_weather();app.db.alerts_sync(function(a){var b;$("#alerts").empty();b='<li data-role="list-divider" class="ui-body-c list-none">No Alerts</li>';0<a.length&&(b='<li data-role="list-divider" class="ui-body-c list-none">'+a.length+" Alerts</li>"+a.map(function(a){return"<li><a href=\"javascript:alert('Summary: "+
a.summary+"\\nMessage: "+a.message+"\\nFrom: "+a.datetime+"\\nExpire: "+a.expired+"')\">"+a.summary+" ("+a.datetime.toLocaleDateString()+")</a></li>"}).join(""));return $("#alerts").html(b).listview().listview("refresh")});return this},pageshow:function(){var a;a=$("#alerts");return a.height(document.body.clientHeight-a.offset().top-this.fh)}});$("#login").bind({pagecreate:function(){$("#login_form").submit(function(a){var b,c,e,d,k;a.preventDefault();a.stopPropagation();if(app.offline())return!1;
e=$("input",this).textinput("disable");k=$("select",this).slider("disable");b=$("button",this).button("disable");$("#btn_reg").addClass("ui-disabled");c=$("#email").val().trim();a=$("#password").val();if(!c||!a)return!1;d=s(c.toLowerCase(),a);app.autologin="on"===$("#autologin").val();p("user",{method:"login",data:{email:c,password:d},callback:function(a){var b;console.log(a);return a.uid&&32===(null!=(b=a.sid)?b.length:void 0)?(app.user={uid:a.uid,email:c,sid:a.sid,psw:s(sid+uid+d)},$.mobile.changePage("#home",
{transition:"flip"})):alert("Login Failed, please try again")},complete:function(){b.button("enable");e.textinput("enable");k.slider("enable");return $("#btn_reg").removeClass("ui-disabled")}});return!1});return this},pagebeforehide:function(){return $("#login_form_warp").hide()},pagebeforeshow:function(){return $("#login_form_warp").hide()},pageshow:function(){$("#password").val("");$("#login_form_warp").show();console.log("logout",app.user);if(navigator.onLine){$("button",this).button("enable");
$("#btn_reg").removeClass("ui-disabled");if(null==app.user)return;p("user",{method:"logout",nowait:!0,data:{uid:app.user.uid,sid:app.user.sid}});app.user=null;app.save_profile()}else $("button",this).button("disable"),$("#btn_reg").addClass("ui-disabled"),app.offline()&&alert("You are offline now!\nLogin need a network.");return this}});$("#reg_form").submit(function(a){var b,c;a.preventDefault();a.stopPropagation();if(app.offline())return!1;if(this.password.value!==this.password2.value)return alert("Password does not match!"),
this.password2.focus(),!1;a=this.email.value.trim();b=this.password.value;b=s(a.toLowerCase(),b);c={email:a,password:b,fullname:{first:this.first.value.trim(),last:this.last.value.trim()},phone:this.phone.value.trim()};console.log("reg",c);p("user",{method:"reg",data:{user:c},callback:function(a){console.log("new id:",a);if(1>a)return alert("Email already exists!");$("#email").val(c.email);$("#reg").dialog("close");return alert("Registration successful!")}});return!1});$("#appointment").bind({pagebeforeshow:function(){var a,
b;if(app.offline())return app.back();$("#datetime").val(Date((new Date).getTime()+36E5).toLocaleString());32!==(null!=(a=app.user)?null!=(b=a.sid)?b.length:void 0:void 0)&&$.mobile.changePage("#login",{transition:"flip",reverse:!0});return!1}});$("#appt_form").submit(function(a){var b,c,d;if(32!==(null!=(b=app.user)?null!=(c=b.sid)?c.length:void 0:void 0)||0===(null!=(d=app.user)?d.uid:void 0)||app.offline())return!1;a.preventDefault();a.stopPropagation();a={user:app.user.uid,place:app.selected_place.id,
contact:{name:this.name.value,phone:this.phone.value},datetime:o.dateToWcf(this.datetime.value),message:this.comments.value};console.log("appt",a);p("appointment",{method:"add",data:{appt:a,sid:app.user.sid},callback:function(a){console.log("appt success:",a);return a?($("#appointment").dialog("close"),alert("Appointment sent successful!")):$.mobile.changePage("#login",{transition:"flip",reverse:!0})}});return!1});$('[data-btn-role="search"]').live({vclick:function(){app.search_keyword=$(this).text();
console.log("vclick",app.search_keyword);return this}});app.custom_search_history_refresh=function(){var a,b;$("#custom_history_list li:gt(0)").remove();a='<li data-role="list-divider" class="ui-body-c list-none">(None)</li>';if(null!=(b=app.user.custom_search_history)&&b.length)a=app.user.custom_search_history.map(function(a){return'<li><a href="#result" data-btn-role="search">'+a+"</a></li>"}).join("");return $("#custom_history_list_header").after(a)};app.place_search_history_refresh=function(){var a,
b;$("#search_history_list li:gt(0)").remove();a='<li data-role="list-divider" class="ui-body-c list-none">(None)</li>';if(null!=(b=app.user.place_search_history)&&b.length)a=app.user.place_search_history.map(function(a,b){return'<li><a href="#detail" data-btn-role="result" data-index="'+b+'"><img src="'+a.icon+'" class="ui-li-icon"><h3 class="ui-li-heading">'+a.name+'</h3><p class="ui-li-desc">'+a.vicinity+"</p></li>"}).join("");return $("#search_history_list_header").after(a)};$("#custom_search").bind({pagecreate:function(){this.created=
!0;app.custom_search_history_refresh();if(!app.offline())return new google.maps.places.Autocomplete($("#input_search")[0],{bounds:d.svbounds,types:["establishment"]})}});$("#custom_search").bind("pageshow pagebeforeshow",function(){if(this.created)return $("#custom_history_list").listview("refresh")});$("#custom_search_form").submit(function(){var a,b;a=$("#input_search");(b=$.trim(a.val()))?(app.search_keyword=new String(b),app.search_keyword.custom=!0,$.mobile.changePage("#result"),console.log("vclick",
app.search_keyword)):a.focus().val("");return!1});$("#search_history").bind({pagecreate:function(){this.created=!0;app.place_search_history_refresh();return $("#search_history li a").live({vclick:function(){return app.selected_place=app.user.place_search_history[Number($(this).attr("data-index"))]}})}});$("#search_history").bind("pageshow pagebeforeshow",function(){if(this.created)return $("#search_history_list").listview("refresh")});$("#result").bind({pagebeforeshow:function(){var a;console.log("search for",
app.search_keyword);if(app.search_keyword)return $.mobile.showPageLoadingMsg(),a=$("#result_list").empty(),app.offline()?$("#result_addr").text("You are offline now"):d.getCurPos(function(b){this.setZoom(12);return d.plcsvc.search({location:b,radius:5E3,keyword:app.search_keyword},function(c,e){var h,k,i;if(e===google.maps.places.PlacesServiceStatus.ZERO_RESULTS)alert("Zero Result"),app.back();else if(e===google.maps.places.PlacesServiceStatus.OK){if($("#result_addr").text(""+app.search_keyword+" ("+
c.length+")"),a.height(document.body.clientHeight-a.offset().top),console.log("search result",c),app.result_map={},c.forEach(function(a){var c,d;app.result_map[a.id]=a;a=a.geometry;d=a.location.lng()-b.lng();c=a.location.lat()-b.lat();return a.dist=Math.pow(d,2)+Math.pow(c,2)}),c.sort(function(a,b){return a.geometry.dist-b.geometry.dist}),c=c.slice(0,25),a.append(c.map(function(a,b){var c;a.seq=String.fromCharCode(65+b);return'<li><a href="#detail" data-btn-role="result" id="'+a.id+'"><div style="float:left">'+
a.seq+'</div><img src="'+(null!=(c=a.icon)?c.replace(/^http:/,""):void 0)+'" class="ui-li-icon"><h3 class="ui-li-heading">'+a.name+'</h3><p class="ui-li-desc">'+a.vicinity+"</p></li>"}).join("")),h=c.reverse().map(function(a){return{position:a.geometry.location,icon:"//www.google.com/mapfiles/marker"+a.seq+".png",title:a.name}}),a.listview("refresh"),h.push({position:b,icon:"//www.google.com/mapfiles/arrow.png",title:"You are here"}),d.setMarkers(h),app.search_keyword.custom&&(h=null!=(i=(k=app.user).custom_search_history)?
i:k.custom_search_history=[],0===h.length||h[0]!==app.search_keyword))h.unshift(app.search_keyword),app.custom_search_history_refresh()}else alert("Search Error");return this})}),this;app.back()}});v=function(a){var b,c,a=Number(a);c=a.toFixed(1);b=a|0;0<b&&(c+=" "+Array(b+1).join('<img src="res/star.png"/>'));0.4<a-b&&(c+='<img src="res/halfstar.png"/>');return c};$("#result_list a").live({vclick:function(){console.log(this.id);return app.selected_place=app.result_map[this.id]}});$("#detail").bind({pagecreate:function(){return $("#apt_cancel").bind({vclick:function(a){a.preventDefault();
a.stopPropagation();$("#appointment").dialog("close");return!1}})},pageshow:function(){var a,b;a=$("#detial_info");a.height(document.body.clientHeight-a.offset().top-this.fh);console.log("detailof",app.selected_place);window.scrollTop=0;if(app.selected_place)return $('[data-role="navbar"] a',this)[app.offline()?"addClass":"removeClass"]("ui-disabled"),b=function(b){var e,h,k,i;d.setCenter(b.geometry.location);d.setMarkers({position:b.geometry.location});d.setZoom(15);$("#detail_place").text(b.name);
a.html("<ul><li>"+b.formatted_address+"</li><li>"+b.formatted_phone_number+"</li><li>"+b.types.join(", ").replace(/_/g," ").toUpperCase()+"</li><li>"+(null!=b.rating?v(b.rating):"(No Rating Data)")+'</li><li><a href="'+(b.website||b.url)+'" target="_blank">'+(null!=b.website?"Visit its Website":"View on Google Place")+"</a></li></ul>");e=null!=(k=(h=app.user).place_search_history)?k:h.place_search_history=[];if(0===e.length||e[0].id!==app.selected_place.id)e.some(function(a,b){return a.id===app.selected_place.id?
(e.splice(b,1),!0):!1}),e.unshift({id:b.id,reference:app.selected_place.reference,name:b.name,vicinity:b.vicinity,icon:null!=(i=b.icon)?i.replace(/^http:/,""):void 0}),app.place_search_history_refresh();console.log(b);return this},app.selected_place.__detail?b(app.selected_place.__detail):app.offline()?alert("todo: offline mode"):d.plcsvc.getDetails({reference:app.selected_place.reference},function(a,d){if(d===google.maps.places.PlacesServiceStatus.OK)return app.selected_place.__detail=a,b(a)}),this;
app.back()}});$("#direction").bind({pagebeforeshow:function(){var a;if(app.offline())return app.back();a=$("#direction_panel");a.height(document.body.clientHeight-a.offset().top);return d.getCurPos(function(b,c){return d.dirsvc.route({origin:c,destination:app.selected_place.vicinity,travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.DirectionsUnitSystem.IMPERIAL,provideRouteAlternatives:!0},function(b,c){return c===google.maps.DirectionsStatus.OK?(d.dirrdr.setMap(d),d.dirrdr.setPanel(a[0]),
d.dirrdr.setDirections(b)):alert("Directions failed: "+c)})})},pagehide:function(){return d.dirrdr.setMap(null)}});console.log(4)}).call(this);
